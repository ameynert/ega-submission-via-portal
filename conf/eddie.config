/*
 * ----------------------------------------------------
 *  University of Edinburgh eddie config file
 * ----------------------------------------------------
 */

executor = "local"

process {

  beforeScript = """
  . /etc/profile.d/modules.sh
  sleep 2;
  """

  penv = "sharedmem"

  cpus = 2
  memory = 4.GB
  time = 4.h
  clusterOptions = "-l h_vmem=${memory.toString().replaceAll(/[\sB]/,'')}"

  errorStrategy = { task.exitStatus in [143,137,104,134,139] ? 'retry' : 'terminate' }
  maxRetries = 1
  maxErrors = '-1'

  withName: encrypt {
    cpus = { check_max( 8, 'cpus' ) }
    memory = { check_max( 16.GB * task.attempt, 'memory' ) }
    time = { check_max( 4.h * task.attempt, 'time' ) }
  }

}

params {
  // Defaults only, expecting to be overwritten
  max_memory = 256.GB
  max_cpus = 16
  max_time = 240.h
}
